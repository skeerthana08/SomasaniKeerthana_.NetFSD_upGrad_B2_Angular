<!DOCTYPE html>
<html>
<head>
    <title>Expense Tracker</title>
</head>
<body>

<h2>Mini Expense Tracker</h2>

<input type="text" id="title" placeholder="Expense Title">
<input type="number" id="amount" placeholder="Amount">
<input type="date" id="date">

<br><br>

<button onclick="addExpense()">Add Expense</button>
<button onclick="viewExpenses()">View Expenses</button>
<button onclick="deleteAll()">Delete All</button>

<ul id="expenseList"></ul>

<script>
let db;

// CREATE DATABASE
let request = indexedDB.open("ExpenseDB", 1);

request.onupgradeneeded = function (event) {
    db = event.target.result;
    db.createObjectStore("expenses", { keyPath: "id", autoIncrement: true });
};

request.onsuccess = function (event) {
    db = event.target.result;
};

request.onerror = function () {
    console.log("Database error");
};

// INSERT
function addExpense() {
    let title = document.getElementById("title").value;
    let amount = document.getElementById("amount").value;
    let date = document.getElementById("date").value;

    let transaction = db.transaction("expenses", "readwrite");
    let store = transaction.objectStore("expenses");

    store.add({ title, amount, date });

    console.log("Expense Added");
}

// SELECT
function viewExpenses() {
    let list = document.getElementById("expenseList");
    list.innerHTML = "";

    let transaction = db.transaction("expenses", "readonly");
    let store = transaction.objectStore("expenses");

    store.openCursor().onsuccess = function (event) {
        let cursor = event.target.result;

        if (cursor) {
            let li = document.createElement("li");
            li.innerText = cursor.value.title + " - " + cursor.value.amount + " - " + cursor.value.date;
            list.appendChild(li);

            cursor.continue();
        }
    };
}

// DELETE
function deleteAll() {
    let transaction = db.transaction("expenses", "readwrite");
    let store = transaction.objectStore("expenses");

    store.clear();
    document.getElementById("expenseList").innerHTML = "";

    console.log("All expenses deleted");
}
</script>

</body>
</html>